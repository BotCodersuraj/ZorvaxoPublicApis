<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Chat Panel</title>
<style>
  body { font-family: Arial, sans-serif; background: #1e1e1e; color: #fff; padding: 20px; }
  h1 { text-align: center; color: #ffcc00; }
  #users { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
  .userBtn { background: #00ffcc; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
  #chatContainer { background: #2c2c2c; padding: 10px; border-radius: 10px; width: 100%; max-width: 600px; margin: auto; display: flex; flex-direction: column; }
  #messages { flex: 1; overflow-y: auto; margin-bottom: 10px; border: 1px solid #555; padding: 5px; border-radius: 5px; height: 300px; }
  .message { padding: 5px 10px; margin: 5px 0; border-radius: 5px; max-width: 80%; }
  .user { background: #00ffcc; color: #000; align-self: flex-start; }
  .admin { background: #ffcc00; color: #000; align-self: flex-end; }
  #inputContainer { display: flex; }
  #inputContainer input { flex: 1; padding: 8px; border-radius: 5px 0 0 5px; border: none; }
  #inputContainer button { padding: 8px; border: none; background: #ffcc00; color: #000; border-radius: 0 5px 5px 0; cursor: pointer; }
</style>
</head>
<body>

<h1>Admin Chat Panel</h1>

<div id="users"></div>

<div id="chatContainer" style="display:none;">
  <div id="messages"></div>
  <div id="inputContainer">
    <input type="text" id="messageInput" placeholder="Type a reply..." />
    <button onclick="sendAdminMessage()">Send</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;
  const usersDiv = document.getElementById('users');
  const chatContainer = document.getElementById('chatContainer');
  const messagesDiv = document.getElementById('messages');

  // Get unique users
  db.ref('chat').on('child_added', snapshot => {
    const msg = snapshot.val();
    if(!usersDiv.querySelector('#user-' + snapshot.key)) {
      const btn = document.createElement('button');
      btn.id = 'user-' + snapshot.key;
      btn.className = 'userBtn';
      btn.innerText = 'User ' + snapshot.key;
      btn.onclick = () => openChat(snapshot.key);
      usersDiv.appendChild(btn);
    }
  });

  function openChat(userKey) {
    currentUser = userKey;
    chatContainer.style.display = 'flex';
    messagesDiv.innerHTML = '';

    db.ref('chat').orderByKey().equalTo(userKey).on('value', snapshot => {
      messagesDiv.innerHTML = '';
      snapshot.forEach(child => {
        const msg = child.val();
        const div = document.createElement('div');
        div.classList.add('message');
        div.classList.add(msg.sender);
        div.innerText = msg.text;
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }

  function sendAdminMessage() {
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if(!text || !currentUser) return;
    db.ref('chat/' + currentUser + '/messages').push({ sender: 'admin', text: text });
    input.value = '';
  }

</script>

</body>
</html>